# EDA 핵심 인사이트 종합 (Phase 1-2)

## 🎯 실행 요약
**날짜**: 2025-12-15  
**분석 완료**: Phase 1 (데이터 기초), Phase 2 (예측 대상)  
**다음 단계**: Phase 3 (시퀀스 패턴)

---

## 📊 Phase 1: 데이터 기초 진단 - 핵심 발견

### 1. 데이터 규모
```
✓ Train 데이터
  - 총 경기: 198개
  - 총 에피소드: 15,435개
  - 총 이벤트: 356,721개
  - 에피소드당 평균 이벤트: 23.1개
  - 경기당 평균 에피소드: 78.0개

✓ Test 데이터
  - 총 경기: 30개
  - 총 에피소드: 2,414개 (예측 대상)
  - 경기당 평균 에피소드: 80.5개

✓ Match Info
  - 총 228 경기 (2024 K League 1)
  - 12개 팀
```

**💡 인사이트**: 충분한 학습 데이터 확보. 테스트 데이터는 약 15% 규모.

---

### 2. 데이터 품질

```
✓ 결측치
  - result_name: 39.32% (정상 - 특정 이벤트는 성공/실패 없음)
  - player_id 결측: 없음 (샘플 기준)
  
✓ 좌표 범위
  - 모든 좌표가 정상 범위 내 (0≤x≤105, 0≤y≤68)
  - 이상치 없음

✓ 시간 정합성
  - action_id와 time_seconds 순서 불일치: 1.85% (286/15,435 에피소드)
  - 시간 역전 에피소드: 1.85%
  ⚠️ 권장: time_seconds 기준 정렬 필수
```

**💡 인사이트**: 데이터 품질 양호. 시간 순서 정렬만 주의하면 됨.

---

### 3. 에피소드 특성

```
✓ 에피소드 길이 (이벤트 개수)
  - 평균: 23.1개
  - 중앙값: 16개
  - 표준편차: 22.0
  - 최소: 1개
  - 최대: 270개
  
✓ 백분위수
  - 25%: 8개
  - 50%: 16개
  - 75%: 31개
  - 90%: 51개
  - 95%: 67개
  - 99%: 102개

✓ 길이별 분포
  - 1-10개: 34.0%
  - 11-20개: 25.2%
  - 21-30개: 15.4%
  - 31-50개: 15.1%
  - 51-100개: 9.2%
  - 100개+: 1.1%
```

**💡 인사이트**: 
- 매우 가변적인 시퀀스 길이
- 95 percentile (67개) 기준으로 Padding/Truncation 권장
- 짧은 에피소드(1-20개)가 전체의 59.2%

---

### 4. 이벤트 타입 분포

```
✓ Top 5 이벤트 타입
  1. Pass: 50.06% (178,582개)
  2. Carry: 23.00% (82,046개)
  3. Recovery: 7.67% (27,352개)
  4. Interception: 3.11% (11,088개)
  5. Duel: 2.45% (8,734개)

✓ 성공/실패
  - Successful: 50.05%
  - NaN (결과 없음): 39.32%
  - Unsuccessful: 10.22%
```

**💡 인사이트**: 
- Pass와 Carry가 전체의 73%
- 26가지 이벤트 타입 → Embedding 필요
- 성공/실패 정보 중요한 피처

---

### 5. 시간 특성

```
✓ 에피소드 지속 시간
  - 평균: 43.8초
  - 중앙값: 28.1초
  - 표준편차: 47.8초
  - 최대: 679.0초 (11분 이상)

✓ 전반/후반
  - Period 1: 50.10%
  - Period 2: 49.90%
  (균등 분포)
```

**💡 인사이트**: 
- 대부분 에피소드는 30초 내외
- 일부 매우 긴 에피소드 존재 (이상치 가능성)
- 전후반 균등 분포

---

## 📊 Phase 2: 예측 대상 분석 - 핵심 발견

### 1. 마지막 패스 좌표 분포

```
✓ end_x (좌우 위치, 0=수비진, 105=공격진)
  - 평균: 68.45m
  - 중앙값: 73.53m
  - 표준편차: 23.85m
  - 범위: 0.00 ~ 105.00m

✓ end_y (상하 위치, 0=왼쪽, 68=오른쪽)
  - 평균: 33.62m
  - 중앙값: 33.11m (거의 중앙)
  - 표준편차: 24.35m
  - 범위: 0.00 ~ 68.00m
```

**💡 인사이트**: 
- X축 편향: 평균 68.45m → **공격 방향으로 치우침** (공격진 55%)
- Y축 중립: 평균 33.62m → 중앙에 가까움 (좌우 거의 균등)
- 표준편차 큼 → 넓은 분포, 예측 난이도 높음

---

### 2. 경기장 영역별 분포

```
✓ X축 (전진 방향)
  - 수비진 (0-35m): 11.1%
  - 중원 (35-70m): 33.9%
  - 공격진 (70-105m): 55.0% ⭐

✓ Y축 (좌우)
  - 좌측 (0-22.67m): 40.8%
  - 중앙 (22.67-45.33m): 19.6%
  - 우측 (45.33-68m): 39.6%
  (좌우 거의 대칭)

✓ 골문 거리
  - 평균: 44.85m
  - 0-20m (골 근처): 11.8%
  - 20-40m: 35.8%
  - 40-60m: 27.9%
```

**💡 인사이트**: 
- **마지막 패스는 공격진에서 가장 많이 발생** → 공격 마무리 단계
- 좌우 균등 → 양쪽 사이드 공격 비슷
- 대부분 골에서 20m 이상 떨어진 지점

---

### 3. 패스 특성

```
✓ 패스 거리
  - 평균: 20.37m
  - 중앙값: 15.74m
  - 표준편차: 15.89m
  - 최대: 93.90m

✓ 거리 분포
  - 0-15m: 47.6% (짧은 패스)
  - 15-30m: 29.8%
  - 30m+: 22.6% (긴 패스)

✓ 패스 방향 (X축)
  - 전진 패스: 83.6% ⭐
  - 후진 패스: 16.4%
  - 평균 X 이동: +13.53m (전진)

✓ 패스 방향 (Y축)
  - 평균 Y 이동: +0.01m (중립)
  - 표준편차: 14.99m (변동 큼)
```

**💡 인사이트**: 
- **대부분 전진 패스** (83.6%)
- 짧은 패스가 주류 (15m 이하가 47.6%)
- Y축은 방향성 없음 (좌우 균등)

---

### 4. 시작-도착 관계

```
✓ 상관계수
  - start_x ↔ end_x: 0.7874 ⭐
  - start_y ↔ end_y: 0.7935 ⭐
```

**💡 인사이트**: 
- **매우 강한 양의 상관관계** (0.79)
- 시작 위치만으로도 상당 부분 예측 가능
- 하지만 완벽하지 않음 (0.79 ≠ 1.0) → 맥락 정보 필요

---

### 5. 베이스라인 성능 ⭐⭐⭐

```
✓ 방법별 평균 유클리드 거리
  1. 전체 평균 예측 (68.45, 33.62): 32.14m
  2. 전체 중앙값 예측 (73.53, 33.11): 31.98m
  3. 시작=도착 예측 (Identity): 20.37m ⭐

✓ 최선의 단순 베이스라인: 20.37m
```

**💡 핵심 인사이트**: 
- **시작 위치를 그대로 예측하는 것이 가장 좋은 단순 베이스라인**
- 이는 start ↔ end의 강한 상관관계를 반영
- **20.37m를 넘어야 모델의 가치 증명**

---

## 🎯 모델링 전략 수립

### 1. 성능 목표 설정

```
✅ 최소 목표 (Minimum Viable):
   - 20m 이하 (베이스라인 이하)

✅ 경쟁력 확보 (Competitive):
   - 15m 이하

✅ 우승권 진입 (Top Tier):
   - 10m 이하

✅ 최고 수준 (State-of-the-art):
   - 7m 이하
```

---

### 2. 피처 엔지니어링 우선순위

**Tier 1 (필수 피처)**
```python
✓ start_x, start_y  # 상관계수 0.79, 가장 중요
✓ delta_x, delta_y  # 이동 방향
✓ pass_distance     # 거리
✓ episode_length    # 시퀀스 길이
✓ time_seconds      # 시간 정보
✓ type_name         # 이벤트 타입 (Embedding)
✓ result_name       # 성공/실패
```

**Tier 2 (중요 피처)**
```python
✓ distance_to_goal  # 골 근접도
✓ x_zone, y_zone    # 경기장 영역
✓ cumulative_x      # 누적 전진도
✓ event_count       # 에피소드 내 이벤트 순서
✓ period_id         # 전반/후반
✓ is_home           # 홈/어웨이
```

**Tier 3 (실험 피처)**
```python
✓ player_id (Embedding)
✓ team_id (Embedding)
✓ rolling_features  # 최근 N개 이벤트 통계
✓ interaction_features  # start_x * type_name 등
```

---

### 3. 모델 아키텍처 방향

**Option 1: 경량 ML 모델 (빠른 실험)**
```
✓ XGBoost / LightGBM
✓ 시퀀스를 집계 피처로 변환
  - 마지막 이벤트 피처
  - 직전 N개 이벤트 통계
  - 에피소드 전체 통계
✓ 장점: 빠름, 해석 가능
✓ 단점: 시퀀스 패턴 포착 한계
```

**Option 2: 시퀀스 모델 (주력)**
```
✓ LSTM / GRU
✓ Bidirectional LSTM
✓ Attention Mechanism
✓ 장점: 시퀀스 패턴 학습
✓ 단점: 학습 시간 김
```

**Option 3: Transformer**
```
✓ Self-Attention
✓ Positional Encoding
✓ 장점: 장거리 의존성, 병렬 처리
✓ 단점: 데이터 많이 필요, 과적합 위험
```

**Option 4: Hybrid (앙상블)**
```
✓ XGBoost + LSTM
✓ 각 모델의 장점 활용
✓ 가중 평균 or Stacking
```

---

### 4. 손실 함수 선택

**Option 1: MSE (Mean Squared Error)**
```python
loss = (pred_x - true_x)^2 + (pred_y - true_y)^2
```
✓ 장점: 표준적, 안정적
✓ 단점: 유클리드 거리와 다름

**Option 2: Euclidean Distance (직접 최적화)**
```python
loss = sqrt((pred_x - true_x)^2 + (pred_y - true_y)^2)
```
✓ 장점: 평가 지표와 일치
✓ 단점: Gradient 불안정 가능

**Option 3: Huber Loss**
```python
# MSE + MAE 하이브리드
```
✓ 장점: 이상치에 강건
✓ 권장: 실험해볼 가치

---

### 5. 전처리 전략

```python
# 1. 정렬
data = data.sort_values(['game_episode', 'time_seconds'])

# 2. 좌표 정규화
scaler = StandardScaler()  # or MinMaxScaler
X_scaled = scaler.fit_transform(data[['start_x', 'start_y', 'end_x', 'end_y']])

# 3. 시퀀스 길이 표준화
max_length = 67  # 95 percentile
# Padding: 짧은 시퀀스는 0으로 채움
# Truncation: 긴 시퀀스는 자름

# 4. 이벤트 타입 인코딩
# Option A: One-Hot Encoding (26차원)
# Option B: Embedding (학습 가능, 10-20차원)

# 5. 결측치 처리
# player_id 결측: -1 (특수 토큰)
```

---

### 6. 검증 전략

**Option 1: Game-based K-Fold**
```
✓ 경기 단위로 5-Fold
✓ 장점: 경기 간 독립성 유지
✓ 권장 방법
```

**Option 2: Time-based Split**
```
✓ 초기 경기 → Train
✓ 후기 경기 → Validation
✓ 장점: 시간 순서 고려
✓ 단점: 검증셋 크기 작음
```

**Option 3: Stratified Split**
```
✓ 에피소드 길이별 층화 추출
✓ 장점: 균형잡힌 검증
```

---

## 🚀 다음 단계 (Phase 3)

### 분석할 내용
1. **시퀀스 패턴 분석**
   - 이벤트 타입 전이 확률 (Bigram, Trigram)
   - 마지막 패스 직전 N개 이벤트의 중요도
   - 전형적인 플레이 시퀀스 패턴

2. **시간적 패턴**
   - 에피소드 경과 시간에 따른 패스 특성 변화
   - 빠른 템포 vs 느린 템포 에피소드 차이

3. **공간적 패턴 심화**
   - 경기장 히트맵
   - 시작 영역별 도착 영역 패턴

4. **팀/선수 분석**
   - 팀별 플레이 스타일
   - 주요 선수 특성

---

## 📝 체크리스트

### 완료 ✅
- [x] Phase 1: 데이터 구조 파악
- [x] Phase 1: 데이터 품질 검증
- [x] Phase 1: 기본 통계 분석
- [x] Phase 2: 예측 대상 좌표 분포
- [x] Phase 2: 패스 특성 분석
- [x] Phase 2: 베이스라인 성능 추정

### 진행 중 🔄
- [ ] Phase 3: 시퀀스 패턴 분석
- [ ] Phase 4: 공간 패턴 시각화
- [ ] Phase 5: 팀/선수 분석

### 대기 중 ⏳
- [ ] 데이터 전처리 파이프라인 구축
- [ ] 베이스라인 모델 개발 (XGBoost)
- [ ] 딥러닝 모델 개발 (LSTM)
- [ ] 앙상블 및 최적화

---

## 💡 최종 핵심 인사이트

1. **베이스라인은 20.37m** - 이것만 넘어도 의미있음
2. **시작 위치가 가장 중요한 피처** - 상관계수 0.79
3. **마지막 패스는 공격진에서 가장 많이 발생** - 55%
4. **대부분 짧은 전진 패스** - 평균 20m, 83.6% 전진
5. **시퀀스 길이 매우 가변적** - 95%는 67개 이하
6. **Pass와 Carry가 전체의 73%** - 핵심 이벤트
7. **좌우는 거의 균등** - Y축 편향 없음

**🎯 결론**: 시작 위치 + 시퀀스 맥락을 잘 활용하면 15m 이하 달성 가능!


