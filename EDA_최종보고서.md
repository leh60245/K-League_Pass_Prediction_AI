# K-리그 패스 예측 AI - EDA 최종 보고서

**작성일**: 2025-12-15  
**분석 Phase**: 1-3 완료  
**분석자**: AI EDA System

---

## 📊 Executive Summary

### 핵심 발견 (Top 5)

1. **베이스라인 성능: 20.37m** (시작 위치 그대로 예측)
   - 이것이 모든 모델이 넘어야 할 최소 기준
   
2. **시작-도착 상관계수: 0.79** (매우 강한 양의 상관)
   - start_x, start_y가 가장 중요한 피처
   - 하지만 완벽하지 않음 → 맥락 필요
   
3. **Pass → Carry → Pass 패턴 우세** (전체의 30%)
   - 명확한 시퀀스 패턴 존재
   - LSTM/GRU 모델링 타당성 입증
   
4. **공격진에서 마지막 패스 55% 발생**
   - X축 편향 존재 (평균 68.45m)
   - Y축은 균등 (평균 33.62m, 중앙값)
   
5. **짧은 전진 패스가 주류** (평균 20m, 83.6% 전진)
   - 대부분 15m 이하 짧은 패스
   - 긴 패스(30m+)는 22.6%

### 성능 목표

```
🎯 최소 목표 (MVP):     < 20m (베이스라인 이하)
🎯 경쟁력 확보:          < 15m
🎯 우승권 진입:          < 10m
🎯 최고 수준:            <  7m
```

---

## 📈 Phase 1: 데이터 기초 진단

### 1.1 데이터 규모

| 항목 | Train | Test |
|------|-------|------|
| 경기 수 | 198 | 30 |
| 에피소드 수 | 15,435 | 2,414 |
| 이벤트 수 | 356,721 | - |
| 평균 에피소드 길이 | 23.1개 | - |

**인사이트**:
- 충분한 학습 데이터 확보 (15K+ 에피소드)
- Test는 Train의 약 15.6% 규모
- 경기당 약 78-80개 에피소드 발생

### 1.2 데이터 품질

✅ **우수**
- 좌표 데이터: 100% 정상 범위 내
- 결측치: result_name 39.32% (정상 - 특정 이벤트는 성공/실패 없음)

⚠️ **주의 필요**
- 시간 순서 불일치: 1.85% (286 에피소드)
- **해결책**: time_seconds 기준 정렬 필수

### 1.3 에피소드 길이 분포

```
Percentile    Length
─────────────────────
25%           8개
50%          16개 (중앙값)
75%          31개
90%          51개
95%          67개 ⭐ (권장 max_length)
99%         102개
```

**인사이트**:
- 매우 가변적 (1 ~ 270개)
- 59.2%가 20개 이하 (짧은 에피소드)
- **권장**: 67개(95%) 기준 Padding/Truncation

### 1.4 이벤트 타입 분포

| Rank | Event Type | Count | Percentage |
|------|------------|-------|------------|
| 1 | Pass | 178,582 | 50.06% |
| 2 | Carry | 82,046 | 23.00% |
| 3 | Recovery | 27,352 | 7.67% |
| 4 | Interception | 11,088 | 3.11% |
| 5 | Duel | 8,734 | 2.45% |

**인사이트**:
- Pass + Carry = 73% (핵심 이벤트)
- 26가지 타입 → Embedding 필수
- 성공률: 50.05% (균형적)

---

## 🎯 Phase 2: 예측 대상 분석

### 2.1 마지막 패스 좌표 분포

#### X축 (전진 방향, 0=수비진, 105=공격진)
```
평균:    68.45m ⭐ (공격 방향 편향)
중앙값:  73.53m
표준편차: 23.85m
범위:    0 ~ 105m
```

**영역별 분포**:
- 수비진 (0-35m): 11.1%
- 중원 (35-70m): 33.9%
- 공격진 (70-105m): **55.0%** ⭐

#### Y축 (좌우, 0=왼쪽, 68=오른쪽)
```
평균:    33.62m (거의 중앙)
중앙값:  33.11m
표준편차: 24.35m
범위:    0 ~ 68m
```

**영역별 분포**:
- 좌측: 40.8%
- 중앙: 19.6%
- 우측: 39.6%
(좌우 거의 균등)

**핵심 인사이트**:
- X축 편향: 공격진에서 마지막 패스 빈번
- Y축 중립: 좌우 균등 분포
- 표준편차 큼 → 예측 난이도 높음

### 2.2 패스 특성

#### 패스 거리
```
평균:    20.37m
중앙값:  15.74m
표준편차: 15.89m
최대:    93.90m
```

**거리 분포**:
- 0-15m: **47.6%** (짧은 패스 주류)
- 15-30m: 29.8%
- 30m+: 22.6% (긴 패스)

#### 패스 방향
```
전진 패스 (X+): 83.6% ⭐
후진 패스 (X-): 16.4%
평균 X 이동: +13.53m
```

**핵심 인사이트**:
- 대부분 짧은 전진 패스
- 평균 13m 전진
- Y축은 방향성 없음 (평균 +0.01m)

### 2.3 시작-도착 관계

```
start_x ↔ end_x: 0.7874 ⭐⭐⭐
start_y ↔ end_y: 0.7935 ⭐⭐⭐
```

**핵심 인사이트**:
- 매우 강한 양의 상관관계
- 시작 위치만으로 상당 부분 예측 가능
- 하지만 0.79 ≠ 1.0 → **맥락 정보 필요**

### 2.4 베이스라인 성능 ⭐⭐⭐

| 방법 | 평균 유클리드 거리 |
|------|-------------------|
| 전체 평균 예측 | 32.14m |
| 전체 중앙값 예측 | 31.98m |
| **시작=도착 예측** | **20.37m** ⭐ |

**결론**: 
- 시작 위치를 그대로 예측하는 것이 최선의 단순 베이스라인
- **20.37m가 모든 모델이 넘어야 할 벽**

---

## 🔄 Phase 3: 시퀀스 패턴 분석

### 3.1 이벤트 전이 패턴 (Bigram)

**Top 5 전이**:
1. Pass → Pass: 22.13% (빠른 연결)
2. Carry → Pass: 20.92% (전진 후 패스)
3. Pass → Carry: 18.25% (패스 후 돌파)
4. Recovery → Pass: 4.81% (볼 탈환 후)
5. Recovery → Carry: 2.74%

**핵심 인사이트**:
- Pass-Carry 조합이 압도적 (60% 이상)
- 명확한 패턴 존재 → 시퀀스 모델링 타당성

### 3.2 마지막 패스 직전 이벤트

| Rank | Event | Percentage |
|------|-------|------------|
| 1 | Carry | 39.9% |
| 2 | Pass | 37.7% |
| 3 | Recovery | 11.9% |
| 4 | Tackle | 3.0% |
| 5 | Throw-In | 2.4% |

**인사이트**:
- Carry/Pass가 77.6% (직전 이벤트)
- 직전 이벤트 타입에 따라 패스 거리 변화:
  - Carry 후: 평균 25.0m (긴 패스)
  - Pass 후: 평균 18.8m
  - Duel 후: 평균 8.5m (짧은 패스)

### 3.3 3-이벤트 시퀀스 (Trigram)

**Top 5 패턴**:
1. Pass → Carry → Pass: 17.27% ⭐
2. Pass → Pass → Pass: 10.42%
3. Carry → Pass → Pass: 8.78%
4. Carry → Pass → Carry: 8.54%
5. Pass → Pass → Carry: 7.98%

**핵심 인사이트**:
- "Pass → Carry → Pass" 패턴이 압도적
- 전체의 30%가 상위 2개 패턴
- 시퀀스 학습 가능성 매우 높음

### 3.4 마지막 직전 2개 이벤트 조합

**Top 3**:
1. Pass → Carry → [마지막 패스]: 30.3% ⭐
2. Pass → Pass → [마지막 패스]: 16.1%
3. Carry → Pass → [마지막 패스]: 14.3%

**모델링 시사점**:
- 마지막 2-3개 이벤트가 매우 중요
- Attention 메커니즘으로 가중치 부여 필요

### 3.5 시간적 패턴

#### 에피소드 지속 시간별
```
0-10초:   end_x 66.7m, 패스거리 17.6m
10-20초:  end_x 67.8m, 패스거리 21.7m
20-30초:  end_x 69.3m, 패스거리 21.0m
30-60초:  end_x 69.1m, 패스거리 21.0m
60초+:    end_x 69.4m, 패스거리 20.9m
```

**인사이트**: 
- 지속 시간과 패스 위치 약한 상관
- 시간 피처는 보조적 역할

#### 플레이 템포별
```
매우 빠름 (<1초/이벤트): 패스거리 14.3m
빠름 (1-2초):          패스거리 20.0m
보통 (2-3초):          패스거리 23.2m
느림 (3초+):           패스거리 27.7m
```

**인사이트**: 
- 템포가 느릴수록 긴 패스 경향
- 하지만 영향력은 제한적

#### 전반/후반
```
Period 1: end_x 67.0m, 패스거리 20.8m
Period 2: end_x 69.8m, 패스거리 20.0m
```

**인사이트**: 
- 큰 차이 없음 (계절성 없음)
- Period 피처는 낮은 우선순위

### 3.6 공간적 시퀀스

#### X축 진행 패턴
```
평균 X 진행: +7.56m (전진)
전진 플레이 (X+10m 이상): 46.5%
안정 플레이 (±10m):       23.0%
후진 플레이 (X-10m 이상): 30.5%
```

**인사이트**:
- 대부분 전진 또는 안정
- 에피소드 전체 X 진행도는 중요 피처

#### 영역 전이 패턴

**수비진 → 도착 영역**:
- 수비진: 43.3%
- 중원: 46.4%
- 공격진: 10.3%

**중원 → 도착 영역**:
- 수비진: 1.6%
- 중원: 50.8%
- 공격진: 47.6%

**공격진 → 도착 영역**:
- 수비진: 0.0%
- 중원: 2.4%
- 공격진: **97.5%** ⭐

**핵심 인사이트**:
- 같은 영역에 머무는 경향 강함
- 공격진에서 시작하면 거의 공격진으로 (97.5%)
- 장거리 이동은 드묾

### 3.7 Carry-Pass 조합 분석

```
발생 빈도: 71,386회 (전체의 ~20%)

Carry 거리:
- 평균: 8.20m
- 중앙값: 6.23m

이어지는 Pass 거리:
- 평균: 19.12m
- 중앙값: 16.25m
```

**Carry 거리별 Pass 성공률**:
- 0-5m: 88.9%
- 5-10m: 88.5%
- 10-15m: 86.9%
- 15m+: 84.8%

**인사이트**:
- Carry가 길수록 Pass 성공률 감소
- Carry-Pass 조합 플래그는 유용한 피처

---

## 🎯 모델링 전략 종합

### 1. 피처 엔지니어링 우선순위

#### Tier 1 (필수 피처) - 상관계수 0.7+
```python
✓ start_x, start_y              # 0.79 상관, 가장 중요
✓ delta_x, delta_y              # 이동 방향
✓ pass_distance                 # 거리
✓ type_name (Embedding)         # 이벤트 타입
✓ result_name                   # 성공/실패
```

#### Tier 2 (중요 피처)
```python
✓ prev_event_type               # 직전 이벤트
✓ prev_2_events                 # 직전 2개 이벤트
✓ episode_length                # 시퀀스 길이
✓ time_seconds                  # 시간
✓ distance_to_goal              # 골 근접도
✓ x_zone, y_zone                # 경기장 영역
✓ x_progression                 # X축 진행도
✓ is_carry_pass                 # Carry-Pass 플래그
```

#### Tier 3 (실험 피처)
```python
✓ tempo                         # 이벤트당 시간
✓ period_id                     # 전반/후반 (낮은 영향)
✓ is_home                       # 홈/어웨이
✓ player_id (Embedding)         # 선수
✓ team_id (Embedding)           # 팀
✓ rolling_stats                 # 최근 N개 통계
```

### 2. 모델 아키텍처 전략

#### Option A: XGBoost (빠른 베이스라인)
```
장점:
✓ 빠른 학습 및 추론
✓ 피처 중요도 분석 가능
✓ 과적합 방지 용이

단점:
✗ 시퀀스 패턴 포착 한계
✗ 집계 피처 필요

권장 용도:
- 초기 베이스라인
- 앙상블의 한 축
```

#### Option B: LSTM/GRU (주력 모델)
```
장점:
✓ 시퀀스 패턴 학습
✓ 가변 길이 처리 (Masking)
✓ Bidirectional로 전후 맥락

단점:
✗ 학습 시간 김
✗ 하이퍼파라미터 많음

권장 아키텍처:
- Embedding Layer (type_name, player_id)
- Bidirectional LSTM (64-128 units, 2 layers)
- Attention Layer (마지막 N개 이벤트 가중)
- Dense Layer (end_x, end_y 동시 예측)
```

#### Option C: Transformer
```
장점:
✓ Self-Attention (장거리 의존성)
✓ 병렬 처리 (빠른 학습)
✓ 최신 기술

단점:
✗ 데이터 많이 필요
✗ 과적합 위험
✗ 복잡한 구조

권장 용도:
- LSTM 성능 한계 시
- 앙상블 다양화
```

#### Option D: Hybrid (권장) ⭐
```
XGBoost + LSTM/GRU 앙상블

1. XGBoost:
   - 집계 피처 활용
   - 시작 위치, 영역, 직전 이벤트 등
   
2. LSTM:
   - 시퀀스 패턴 학습
   - 전체 에피소드 활용
   
3. Ensemble:
   - 가중 평균 or Stacking
   - XGBoost 40%, LSTM 60%
```

### 3. 손실 함수

#### 권장: MSE (Mean Squared Error)
```python
loss = (pred_x - true_x)^2 + (pred_y - true_y)^2
```
✓ 안정적, 표준적
✓ 유클리드 거리와 밀접

#### 대안: Custom Euclidean Loss
```python
loss = sqrt((pred_x - true_x)^2 + (pred_y - true_y)^2)
```
✓ 평가 지표와 일치
⚠️ Gradient 불안정 가능 → Smooth L1 고려

### 4. 전처리 전략

```python
# 1. 정렬
data = data.sort_values(['game_episode', 'time_seconds'])

# 2. 좌표 정규화
scaler = StandardScaler()
# X: 0-105 → -2 ~ +2
# Y: 0-68 → -2 ~ +2

# 3. 시퀀스 Padding
max_length = 67  # 95 percentile
# 짧은 시퀀스: 0으로 Padding
# 긴 시퀀스: Truncation

# 4. 이벤트 타입 Embedding
vocab_size = 26  # 26가지 타입
embedding_dim = 16

# 5. Masking
# Padding된 부분은 Loss 계산 제외
```

### 5. 검증 전략

#### Game-based 5-Fold CV (권장) ⭐
```
✓ 경기 단위로 분할
✓ 경기 간 독립성 유지
✓ 안정적인 성능 평가

Fold 1: Game 1-40    (Val), Game 41-198 (Train)
Fold 2: Game 41-79   (Val), ...
...
```

#### 주의사항
- Test 경기는 Train에 없음 (시간상 나중)
- 시간 순서 고려 필요
- Public/Private 분포 차이 모니터링

---

## 📊 예상 성능 및 목표

### 성능 예측

| 모델 | 예상 성능 (m) | 근거 |
|------|--------------|------|
| XGBoost (집계) | 15-18m | 시작 위치 + 기본 피처 |
| LSTM (시퀀스) | 12-15m | 시퀀스 패턴 학습 |
| Hybrid (앙상블) | 10-12m | 장점 결합 |
| 최적화 후 | 8-10m | 하이퍼파라미터, 피처 최적화 |

### 단계별 목표

```
Week 1: 베이스라인
- XGBoost: < 18m 달성
- LSTM 기본: < 15m 달성

Week 2: 최적화
- 앙상블: < 12m 달성
- 피처 엔지니어링 심화

Week 3: 최종 튜닝
- 목표: < 10m 달성
- Public LB 상위 10% 진입
```

---

## 🚀 다음 액션 아이템

### Immediate (오늘-내일)

1. **데이터 전처리 파이프라인 구축** ⭐⭐⭐
   - [ ] 시간 정렬 함수
   - [ ] 좌표 정규화
   - [ ] 시퀀스 Padding/Truncation
   - [ ] Train/Val Split (Game-based)

2. **베이스라인 모델 (XGBoost)** ⭐⭐⭐
   - [ ] 집계 피처 생성
   - [ ] 모델 학습
   - [ ] 성능 평가 (목표: < 18m)

### Short-term (3-5일)

3. **LSTM 모델 개발** ⭐⭐
   - [ ] 시퀀스 데이터 생성
   - [ ] 이벤트 타입 Embedding
   - [ ] Bidirectional LSTM 구현
   - [ ] 성능 평가 (목표: < 15m)

4. **피처 엔지니어링 심화** ⭐⭐
   - [ ] Tier 2 피처 추가
   - [ ] 상호작용 피처
   - [ ] 피처 선택

### Mid-term (1주)

5. **모델 앙상블** ⭐
   - [ ] XGBoost + LSTM 조합
   - [ ] 가중치 최적화
   - [ ] 성능 평가 (목표: < 12m)

6. **하이퍼파라미터 튜닝** ⭐
   - [ ] Optuna 적용
   - [ ] Grid Search
   - [ ] Cross Validation

### Long-term (2-3주)

7. **고급 모델 실험**
   - [ ] Transformer
   - [ ] Attention 메커니즘
   - [ ] 앙상블 다양화

8. **최종 제출 준비**
   - [ ] 코드 정리
   - [ ] 문서화
   - [ ] inference.py 작성
   - [ ] 모델 가중치 저장

---

## 📝 핵심 인사이트 요약 (Top 10)

1. **베이스라인 20.37m** - 시작 위치 그대로 예측
2. **start ↔ end 상관 0.79** - 가장 중요한 피처
3. **Pass → Carry → Pass 30%** - 명확한 시퀀스 패턴
4. **공격진 55% 발생** - X축 편향
5. **좌우 균등 분포** - Y축 편향 없음
6. **짧은 전진 패스 주류** - 평균 20m, 83.6% 전진
7. **에피소드 길이 가변적** - 95%는 67개 이하
8. **Pass + Carry 73%** - 핵심 이벤트
9. **영역 내 머무름 경향** - 공격진 → 공격진 97.5%
10. **직전 2-3개 이벤트 중요** - Attention 필요

---

## ✅ EDA 완료 체크리스트

- [x] Phase 1: 데이터 기초 진단
  - [x] 데이터 구조 파악
  - [x] 데이터 품질 검증
  - [x] 기본 통계 분석
  
- [x] Phase 2: 예측 대상 분석
  - [x] 좌표 분포 분석
  - [x] 패스 특성 분석
  - [x] 베이스라인 성능 추정
  
- [x] Phase 3: 시퀀스 패턴 분석
  - [x] 이벤트 전이 패턴
  - [x] 직전 이벤트 영향
  - [x] 시간적 패턴
  - [x] 공간적 시퀀스
  - [x] Carry-Pass 조합

- [ ] Phase 4: 시각화 (선택)
  - [ ] 경기장 히트맵
  - [ ] 시퀀스 다이어그램
  - [ ] 오차 분포 시각화

---

## 🎯 결론

**"시작 위치 + 시퀀스 맥락"이 핵심**

1. 시작 위치(start_x, start_y)는 가장 강력한 예측 인자 (상관 0.79)
2. 하지만 완벽하지 않음 → 시퀀스 맥락이 필요
3. Pass-Carry-Pass 패턴이 명확 → LSTM/GRU 타당성 입증
4. 베이스라인 20.37m를 넘어 15m 이하 달성 가능성 높음
5. 최적화 시 10m 이하도 충분히 가능

**다음 단계**: 전처리 파이프라인 구축 및 베이스라인 모델 개발 시작! 🚀


